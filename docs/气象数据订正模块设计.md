### **第1步：数据导入**



#### **模块设计**

该模块是所有操作的起点，负责将文件型数据录入数据库。

- **输入**
  - 原始站点数据（.csv 文件集合）
- **处理流程**
  - 读取 CSV 文件。
  - 将文件内容写入 SQLite 数据库中的指定数据表（例如，`raw_station_data`）。
- **输出**
  - 一个包含所有原始站点数据的 SQLite 数据库文件。



#### **用户使用设计**

- **用户输入/配置**:
  1. **选择数据源**: 用户点击“选择文件夹”按钮，在弹出的窗口中选择包含所有站点`.csv`文件的文件夹。
  2. **执行操作**: 用户点击“开始导入”按钮。
- **系统反馈**:
  - 界面上出现一个**进度条**，显示文件导入和数据库写入的实时进度。
  - 导入完成后，弹出“导入成功”或“导入失败”的提示。

------



### **第2步：数据预览**



#### **模块设计**

该模块用于快速查看原始数据。

**2.1 站点数据显示**

- **输入**
  - 站点名
  - 要素 (温度，相对湿度，降水量，平均风速)
  - 时间范围 (起始时间与结束时间)
- **数据来源**
  - 从 SQLite 数据库的 `raw_station_data` 表中查询。
- **输出**
  - 所选站点、要素和时间段对应的折线图。
  - 该站点的经纬度信息。

**2.2 格点数据显示**

- **输入**
  - 要素 (温度，相对湿度，降水量，平均风速)
  - 特定时刻
- **数据来源**
  - 从原始 .nc 文件中读取。
- **输出**
  - 该要素在该时刻的热力图 (带色标)。
  - 热力图以湖北省地图为背景。



#### **用户使用设计**

- **用户输入/配置**:
  - **站点数据**: 选择【站点】、【要素】、【时间范围】。
  - **格点数据**: 选择【要素】、【时刻】。
  - **执行操作**: 点击“生成图表/热力图”按钮。
- **系统反馈**:
  - 点击按钮后，出现一个短暂的“加载中...”提示或动画。
  - 图表或热力图在界面上显示出来。

------



### **第3步：数据透视**



#### **模块设计**

该模块用于对比分析项目流程中不同阶段的数据和指标。在数据预处理前，此模块可用于直接计算和展示原始数据的各项指标。

- **通用输入**
  - 数据来源 (原始数据、清洗后、建模后或订正后)
  - 站点名
  - 要素 (温度，相对湿度，降水量，平均风速)
  - 时间范围
- **根据不同数据来源的输出**
  - **选择"原始数据"**
    - **数据来源**: 从 SQLite 的 `raw_station_data` 表查询。
    - **输出**: 折线图、指标表格、原始数据导出功能。
  - **选择"预处理后"**
    - **数据来源**: 从 SQLite 的 `preprocessed_data` 表查询。
    - **输出**: 折线图、指标表格、预处理后的合并数据导出功能。
  - **选择"建模后"**
    - **数据来源**: 建模过程产生的指标结果（可存为文件或数据库表）。
    - **输出**: 对应算法、站点和要素的指标表格、指标导出功能。
  - **选择"订正后"**
    - **数据来源**: 订正过程生成的格点数据（.nc 文件）以及原始格点数据（.nc 文件）。
    - **输出**: **指定时刻订正前、后的对比热力图**、订正后的格点数据 (.nc格式) 导出功能。



#### **用户使用设计**

- **用户输入/配置**:
  1. **选择数据阶段**: 用户选择`原始数据`, `预处理后数据`, `建模后指标`, 或 `订正后数据`。
  2. **配置查询参数**: 根据所选阶段，配置相应的查询条件（如站点、时间、模型等）。
  3. **执行操作**: 点击“查询/分析”按钮。
- **系统反馈**:
  - 出现短暂的“加载中...”提示。
  - 在界面上展示用户所请求的图表或数据表格。
  - **特别地**，当选择“订正后数据”并查询某一时刻时，界面将**并排展示两张热力图**：左边为原始格点图，右边为订正后的格点图，以便用户直观对比效果。

------



### **第4步：数据预处理**



#### **模块设计**

该模块负责清洗和整合数据，为建模做准备。

- **输入**
  - 来自数据库的原始站点数据。
  - 原始格点数据（.nc 文件）。
- **处理流程**
  1. **数据清洗**: 对从数据库中读出的站点数据进行缺失值、异常值处理和时间格式转换。
  2. **格点数据提取**: 根据站点的经纬度，从 .nc 文件中提取对应位置的数值。
  3. **数据合并**: 将清洗后的站点数据与提取出的格点数据合并。
  4. **导入数据库**: 将最终生成的干净、合并后的数据存入 SQLite 数据库的一个新表（例如，`preprocessed_data`）。
- **输出**
  - 更新后的 SQLite 数据库，其中包含了预处理后的数据表。



#### **用户使用设计**

- **用户输入/配置**:
  1. **选择要素**: 用户从下拉菜单中选择本次预处理针对的气象要素（如：“温度”）。
  2. **选择时间范围**: 使用日期时间选择器，设定预处理的时间范围。
  2. **执行操作**: 用户点击“开始预处理”按钮。
- **系统反馈**:
  - 界面上出现一个**进度条**，反馈数据清洗、格点提取、数据合并和入库的总体进度。
  - 处理完成后，给出成功或失败的提示。

------



### **第5步：建模**



#### **模块设计**

该模块的目标是训练一个或多个机器学习模型，让模型学习“站点观测数据”与“格点背景数据”之间的复杂关系（即偏差模式）。

- **输入**
  1. **预处理后的数据**: 从 SQLite 的 `preprocessed_data` 表中读取。
  2. **算法选择**: 用户或开发者选择要使用的机器学习算法（例如：随机森林、梯度提升树XGBoost、神经网络等）。
- **处理流程**
  1. **特征工程**: 根据现有特征创造出对模型更有用的新特征。
  2. **数据划分**: 将数据随机划分为**训练集**和**测试集**。
  3. **模型训练**: 在训练集上，使用选择的算法进行模型训练。
  4. **模型评估**: 在测试集上进行预测并计算评估指标。
  5. **模型保存**: 将训练好的模型保存为单个文件。
- **输出**
  1. **训练好的模型文件**
  2. **模型评估指标**



#### **用户使用设计**

- **用户输入/配置**:
  1. **选择要素**: 从下拉菜单中选择本次建模针对的气象要素（如：“温度”）。
  2. **选择时间范围**: 使用日期时间选择器，设定用于建模的“起始时间”和“结束时间”。
  3. **选择数据划分方式**: 提供下拉菜单，选项为：
     - `按年份划分`
     - `按站点划分`
  4. **指定测试集 (动态显示)**:
     - 如果选择`按年份划分`，则出现一个输入框，要求用户输入测试集年份列表（如：`2022, 2023`）。
     - 如果选择`按站点划分`，则出现一个多选列表，要求用户勾选作为测试集的站点名称。
  5. **选择算法**: 从下拉菜单中选择一个机器学习算法（如：“随机森林”、“XGBoost”）。
  6. **配置算法参数 (动态显示)**: 根据选择的算法，动态显示对应的参数输入框（如`决策树数量`、`学习率`等）。
  7. **执行操作**: 用户点击“开始训练”按钮。
- **系统反馈**:
  - 界面上出现一个**进度条**，实时显示模型训练的进度。
  - 训练完成后，清晰地展示出该模型的评估指标（MAE、RMSE等）。

------



### **第6步：订正**



#### **模块设计**

该模块是项目的最终应用阶段。它使用训练好的模型，对整个湖北省范围内的原始格点数据进行全面订正，生成更高精度的气象格点图。

- **输入**
  1. **已保存的模型文件**
  2. **原始格点数据 (.nc)**
  3. **订正参数**: 时间范围、要素。
- **处理流程**
  1. **加载模型**
  2. **准备预测数据**: 为格点图中的**每一个像素点**，构建一个符合模型输入要求的特征向量。
  3. **执行批量预测**: 将整个区域所有像素点的特征向量输入到加载好的模型中，模型会为每一个像素点输出一个**订正后的预测值**。
  4. **生成订正格点**: 将所有像素点的预测结果重新组织成一个二维数组。
  5. **循环处理**: 按照输入的时间范围，对每一个时刻重复上述步骤。
  6. **保存结果**: 将每张订正后的格点图保存为一张独立的 `.nc` 文件。
- **输出**
  1. **订正后的格点数据**: 一系列 `.nc` 文件。



#### **用户使用设计**

- **用户输入/配置**:
  1. **选择模型**: 从下拉菜单中选择一个之前训练并保存好的模型。
  2. **选择订正时间范围**: 使用日期时间选择器，设定需要进行订正的“起始时间”和“结束时间”。
  3. **执行操作**: 用户点击“开始订正”按钮。
- **系统反馈**:
  - 界面上出现一个**进度条**，清晰地反馈当前已处理到哪个时刻，以及总体进度。
  - 订正完成后，提示“订正任务已完成，可在数据透视模块查看结果”。



补充：所有模块的前后端进度交互基于sqlite进行。后端在开始第一个模块任务时就创建一张全流程(六个模块)的任务进度表。里面包含如下字段：

- 进度文字说明(jdwzsm)
- 发起时间(fqsj)
- 当前进度(dqjd)
- 状态(zt)
- 类型(lx)
- 结束时间(jssj)
- 任务参数(rwcs)
- 任务名称(rwmc)

例如：在开始数据导入任务时(82个站点分批导入)，每个文件的导入作为一个原子任务(需要根据每次插入的批量对每个文件导入进行进度记录)。以及整个数据导入任务的进度(82个站点全部导入完成，同时记录排队中，处理中，已完成，失败四种状态。任务失败时记录失败的文件名)。此外还需要考虑历史任务的查询。